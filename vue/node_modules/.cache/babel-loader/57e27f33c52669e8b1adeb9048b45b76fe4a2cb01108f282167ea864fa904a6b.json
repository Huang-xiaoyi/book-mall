{"ast":null,"code":"import request from \"@/utils/request\";\nexport default {\n  name: 'Admin',\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('userInfo') || '{}'),\n      form: {},\n      search: {},\n      dialogVisible: false,\n      pageNum: 1,\n      pageSize: 6,\n      total: 0,\n      tableData: []\n    };\n  },\n  created() {\n    this.loadData();\n  },\n  methods: {\n    //  当点击页码时，当前页码数赋值给data变量pageNum\n    handleCurrentChange(pageNum) {\n      this.pageNum = pageNum;\n      this.loadData();\n    },\n    // 分页加载表格数据\n    loadData() {\n      request.get(\"/admin/selectPage\", {\n        params: {\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          username: this.search.username\n        }\n      }).then(res => {\n        if (res.code == '0') {\n          this.tableData = res.data.list;\n          this.total = res.data.total;\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    reset() {\n      this.search.username = null;\n      this.loadData();\n    },\n    add() {\n      this.form = {};\n      this.dialogVisible = true;\n    },\n    save() {\n      if (!this.form.id) {\n        //新增 为空\n        request.post(\"admin/save\", this.form).then(res => {\n          if (res.code === '0') {\n            this.$message.success('保存成功');\n            this.loadData();\n            this.dialogVisible = false;\n          } else {\n            this.$message.error(res.msg);\n          }\n        });\n      } else {\n        request.post(\"admin/update\", this.form).then(res => {\n          if (res.code === '0') {\n            //若当前修改的管理员信息为登录用户  保持右上角管理员信息同步更新\n            if (this.user.id == this.form.id) {\n              localStorage.setItem(\"userInfo\", JSON.stringify(this.form));\n              this.$emit('update:user');\n            }\n            this.$message.success('修改成功');\n            this.loadData();\n            this.dialogVisible = false;\n          } else {\n            this.$message.error(res.msg);\n          }\n        });\n      }\n    },\n    del(id) {\n      this.$confirm('您确定删除吗？', '确认删除', {\n        type: \"warning\"\n      }).then(response => {\n        request.delete('/admin/delete/' + id).then(res => {\n          if (res.code === '0') {\n            // 表示操作成功\n            this.$message.success('操作成功');\n            this.loadData();\n          } else {\n            this.$message.error(res.msg); // 弹出错误的信息\n          }\n        });\n      }).catch(() => {});\n    },\n    edit(row) {\n      this.form = row;\n      this.dialogVisible = true;\n    },\n    handleAvatarSuccess(response) {\n      // 获取后台传来的图片路径\n      this.form.avatar = response.data;\n      this.$forceUpdate();\n    }\n  }\n};","map":{"version":3,"names":["request","name","data","user","JSON","parse","localStorage","getItem","form","search","dialogVisible","pageNum","pageSize","total","tableData","created","loadData","methods","handleCurrentChange","get","params","username","then","res","code","list","$message","error","msg","reset","add","save","id","post","success","setItem","stringify","$emit","del","$confirm","type","response","delete","catch","edit","row","handleAvatarSuccess","avatar","$forceUpdate"],"sources":["src/views/manage/Admin.vue"],"sourcesContent":["<template>\r\n\r\n  <div>\r\n    <el-card  class=\"top-card\">\r\n    <div class=\"search\">\r\n      <el-input  class=\"search-input\"  v-model=\"search.username\" placeholder=\"请输入用户名\" suffix-icon=\"el-icon-search\"></el-input>\r\n      <el-button type=\"primary\" class=\"search-button\"  plain @click=\"loadData()\">搜索</el-button>\r\n      <el-button type=\"warning\"  plain @click=\"reset()\">重置</el-button>\r\n    </div>\r\n\r\n      <el-button  type=\"primary\" @click=\"add()\">新增</el-button>\r\n\r\n    </el-card>\r\n    <el-card>\r\n    <el-table\r\n        :header-cell-style=\"{'text-align':'center'}\"\r\n        :cell-style=\"{'text-align':'center'}\"\r\n        :data=\"tableData\"\r\n        style=\"width: 100%\">\r\n      <el-table-column prop=\"id\" label=\"ID\" width=\"50\"></el-table-column>\r\n      <el-table-column label=\"头像\">\r\n        <template v-slot=\"scope\">\r\n          <el-image :src=\"scope.row.avatar\" :preview-src-list=\"[scope.row.avatar]\" class=\"table-img\" ></el-image>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"name\" label=\"名字\" > </el-table-column>\r\n      <el-table-column prop=\"username\" label=\"用户名\" > </el-table-column>\r\n      <el-table-column prop=\"password\" label=\"密码\"> </el-table-column>\r\n      <el-table-column prop=\"email\" label=\"邮箱\" ></el-table-column>\r\n      <el-table-column prop=\"phone\" label=\"电话\"> </el-table-column>\r\n            <el-table-column prop=\"\" label=\"操作\" width=\"160\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button type=\"primary\"  icon=\"\" @click=\"edit(scope.row)\">编辑</el-button>\r\n          <el-button type=\"danger\"  @click=\"del(scope.row.id)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!--分页-->\r\n        <div  class=\"pagination-div\">\r\n      <el-pagination\r\n          background\r\n          @current-change=\"handleCurrentChange\"\r\n          :current-page=\"pageNum\"\r\n          :page-sizes=\"[5, 10, 20]\"\r\n          :page-size=\"pageSize\"\r\n          layout=\"total, prev, pager, next\"\r\n          :total=\"total\">\r\n      </el-pagination>\r\n\r\n    </div>\r\n    </el-card>\r\n    <!--模态框-->\r\n    <el-dialog title=\"管理员信息\" :visible.sync=\"dialogVisible\" width=\"40%\">\r\n      <el-form :model=\"form\" label-position=\"right\" label-width=\"100px\" class=\"dialog-form\">\r\n        <el-form-item label=\"名字\">\r\n          <el-input  v-model=\"form.name\" placeholder=\"请输入名字\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"用户名\">\r\n          <el-input  v-model=\"form.username\" placeholder=\"请输入用户名\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"密码\">\r\n          <el-input  v-model=\"form.password\" placeholder=\"请输入密码\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"邮箱\">\r\n          <el-input  v-model=\"form.email\" placeholder=\"请输入邮箱\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"电话\">\r\n          <el-input  v-model=\"form.phone\" placeholder=\"请输入手机号\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"头像\">\r\n          <el-upload\r\n              class=\"avatar-uploader\"\r\n              action=\"http://localhost:9090/files/upload\"\r\n              :show-file-list=\"false\"\r\n              :on-success=\"handleAvatarSuccess\">\r\n            <img v-if=\"form.avatar\" :src=\"form.avatar\" class=\"avatar\">\r\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n          </el-upload>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button  @click=\"dialogVisible = false\">取 消</el-button>\r\n        <el-button  type=\"primary\" @click=\"save\">保 存</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n\r\n  </div>\r\n\r\n\r\n</template>\r\n\r\n<script>\r\n\r\nimport request from \"@/utils/request\";\r\nexport default {\r\n  name: 'Admin',\r\n\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem('userInfo') || '{}'),\r\n      form:{},\r\n      search:{},\r\n      dialogVisible:false,\r\n      pageNum:1,\r\n      pageSize:6,\r\n      total:0,\r\n      tableData: []\r\n    }\r\n  },\r\n  created() {\r\n    this.loadData()\r\n  },\r\n  methods:{\r\n    //  当点击页码时，当前页码数赋值给data变量pageNum\r\n    handleCurrentChange(pageNum) {\r\n      this.pageNum = pageNum;\r\n      this.loadData()\r\n    },\r\n    // 分页加载表格数据\r\n    loadData() {\r\n      request.get(\"/admin/selectPage\",{\r\n        params:{\r\n          pageNum:this.pageNum,\r\n          pageSize:this.pageSize,\r\n          username:this.search.username\r\n        }\r\n      }).then(res=>{\r\n        if (res.code=='0'){\r\n          this.tableData = res.data.list\r\n          this.total=res.data.total\r\n        }\r\n        else {\r\n          this.$message.error(res.msg)\r\n        }\r\n      })\r\n    },\r\n    reset(){\r\n      this.search.username = null\r\n      this.loadData()\r\n    },\r\n    add(){\r\n      this.form = {}\r\n      this.dialogVisible=true\r\n    },\r\n\r\n    save() {\r\n      if (!this.form.id) {\r\n        //新增 为空\r\n        request.post(\"admin/save\", this.form).then(res => {\r\n          if (res.code === '0') {\r\n            this.$message.success('保存成功');\r\n            this.loadData()\r\n            this.dialogVisible = false\r\n          }\r\n          else {\r\n            this.$message.error(res.msg)\r\n          }\r\n        })\r\n      } else {\r\n        request.post(\"admin/update\", this.form).then(res => {\r\n          if (res.code === '0') {\r\n            //若当前修改的管理员信息为登录用户  保持右上角管理员信息同步更新\r\n            if (this.user.id==this.form.id){\r\n              localStorage.setItem(\"userInfo\",JSON.stringify(this.form))\r\n              this.$emit('update:user')\r\n            }\r\n            this.$message.success('修改成功');\r\n            this.loadData()\r\n            this.dialogVisible = false\r\n          }\r\n          else {\r\n            this.$message.error(res.msg)\r\n          }\r\n        })\r\n      }\r\n    },\r\n\r\n    del(id){\r\n      this.$confirm('您确定删除吗？', '确认删除', {type: \"warning\"}).then(response => {\r\n        request.delete('/admin/delete/' + id).then(res => {\r\n          if (res.code === '0') {   // 表示操作成功\r\n            this.$message.success('操作成功')\r\n            this.loadData()\r\n          } else {\r\n            this.$message.error(res.msg)  // 弹出错误的信息\r\n          }\r\n        })\r\n      })\r\n          .catch(()=>{})\r\n    },\r\n    edit(row){\r\n      this.form=row\r\n      this.dialogVisible=true\r\n    },\r\n    handleAvatarSuccess(response) {\r\n      // 获取后台传来的图片路径\r\n      this.form.avatar = response.data\r\n      this.$forceUpdate()\r\n    },\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"AA8FA,OAAAA,OAAA;AACA;EACAC,IAAA;EAEAC,KAAA;IACA;MACAC,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,IAAA;MACAC,MAAA;MACAC,aAAA;MACAC,OAAA;MACAC,QAAA;MACAC,KAAA;MACAC,SAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,QAAA;EACA;EACAC,OAAA;IACA;IACAC,oBAAAP,OAAA;MACA,KAAAA,OAAA,GAAAA,OAAA;MACA,KAAAK,QAAA;IACA;IACA;IACAA,SAAA;MACAhB,OAAA,CAAAmB,GAAA;QACAC,MAAA;UACAT,OAAA,OAAAA,OAAA;UACAC,QAAA,OAAAA,QAAA;UACAS,QAAA,OAAAZ,MAAA,CAAAY;QACA;MACA,GAAAC,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAV,SAAA,GAAAS,GAAA,CAAArB,IAAA,CAAAuB,IAAA;UACA,KAAAZ,KAAA,GAAAU,GAAA,CAAArB,IAAA,CAAAW,KAAA;QACA,OACA;UACA,KAAAa,QAAA,CAAAC,KAAA,CAAAJ,GAAA,CAAAK,GAAA;QACA;MACA;IACA;IACAC,MAAA;MACA,KAAApB,MAAA,CAAAY,QAAA;MACA,KAAAL,QAAA;IACA;IACAc,IAAA;MACA,KAAAtB,IAAA;MACA,KAAAE,aAAA;IACA;IAEAqB,KAAA;MACA,UAAAvB,IAAA,CAAAwB,EAAA;QACA;QACAhC,OAAA,CAAAiC,IAAA,oBAAAzB,IAAA,EAAAc,IAAA,CAAAC,GAAA;UACA,IAAAA,GAAA,CAAAC,IAAA;YACA,KAAAE,QAAA,CAAAQ,OAAA;YACA,KAAAlB,QAAA;YACA,KAAAN,aAAA;UACA,OACA;YACA,KAAAgB,QAAA,CAAAC,KAAA,CAAAJ,GAAA,CAAAK,GAAA;UACA;QACA;MACA;QACA5B,OAAA,CAAAiC,IAAA,sBAAAzB,IAAA,EAAAc,IAAA,CAAAC,GAAA;UACA,IAAAA,GAAA,CAAAC,IAAA;YACA;YACA,SAAArB,IAAA,CAAA6B,EAAA,SAAAxB,IAAA,CAAAwB,EAAA;cACA1B,YAAA,CAAA6B,OAAA,aAAA/B,IAAA,CAAAgC,SAAA,MAAA5B,IAAA;cACA,KAAA6B,KAAA;YACA;YACA,KAAAX,QAAA,CAAAQ,OAAA;YACA,KAAAlB,QAAA;YACA,KAAAN,aAAA;UACA,OACA;YACA,KAAAgB,QAAA,CAAAC,KAAA,CAAAJ,GAAA,CAAAK,GAAA;UACA;QACA;MACA;IACA;IAEAU,IAAAN,EAAA;MACA,KAAAO,QAAA;QAAAC,IAAA;MAAA,GAAAlB,IAAA,CAAAmB,QAAA;QACAzC,OAAA,CAAA0C,MAAA,oBAAAV,EAAA,EAAAV,IAAA,CAAAC,GAAA;UACA,IAAAA,GAAA,CAAAC,IAAA;YAAA;YACA,KAAAE,QAAA,CAAAQ,OAAA;YACA,KAAAlB,QAAA;UACA;YACA,KAAAU,QAAA,CAAAC,KAAA,CAAAJ,GAAA,CAAAK,GAAA;UACA;QACA;MACA,GACAe,KAAA;IACA;IACAC,KAAAC,GAAA;MACA,KAAArC,IAAA,GAAAqC,GAAA;MACA,KAAAnC,aAAA;IACA;IACAoC,oBAAAL,QAAA;MACA;MACA,KAAAjC,IAAA,CAAAuC,MAAA,GAAAN,QAAA,CAAAvC,IAAA;MACA,KAAA8C,YAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}