"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[222],{3222:function(t,e,s){s.r(e),s.d(e,{default:function(){return v}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"book-container"},[e("div",{staticClass:"book-information"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"book-image-container"},[e("img",{staticClass:"book-image",attrs:{src:t.book.pic}})])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"book-name"},[t._v(t._s(t.book.name))])]),e("el-col",{attrs:{span:6,offset:4}},[e("div",{staticClass:"book-price"},[t._v("￥"+t._s(t.book.price))])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"book-author"},[t._v(t._s(t.book.author))])]),e("el-col",{attrs:{span:18}}),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"description-container"},[e("div",{class:["description-content",{expanded:t.isDescriptionExpanded}],attrs:{rel:"descriptionText"}},[t._v(" "+t._s(t.book.detail)+" ")]),t.showReadMore?e("div",{staticClass:"read-more-gradient"}):t._e(),e("div",{staticClass:"read-more-container"},[e("span",{staticClass:"read-more-btn",on:{click:t.toggleDescription}},[t._v(" "+t._s(t.isDescriptionExpanded?"收起":"查看更多")+" ")])])])]),t._v("qia "),e("el-col",{attrs:{span:18}}),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"purchase-number"},[e("el-input-number",{attrs:{min:1,max:t.book.stock,label:"描述文字"},model:{value:t.booknum,callback:function(e){t.booknum=e},expression:"booknum"}}),t._v(" 库存"+t._s(t.book.stock)+" ")],1)])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6,offset:6}},[e("el-button",{attrs:{type:"warning"}},[t._v("收藏")]),e("el-button",{attrs:{type:"danger"}},[t._v("加入购物车")])],1)],1)],1),e("Comment",{attrs:{"book-id":t.book?t.book.id:null}})],1)},a=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-container"},[e("div",{staticClass:"comment-header"},[e("h3",[t._v("评论区")]),e("span",{staticClass:"comment-count"},[t._v("共 "+t._s(t.comments.length)+" 条评论")])]),t.isLoggedIn?e("div",{staticClass:"comment-input-area"},[e("el-input",{staticClass:"comment-input",attrs:{type:"textarea",rows:3,placeholder:"写下你的评论..."},model:{value:t.newComment,callback:function(e){t.newComment=e},expression:"newComment"}}),e("div",{staticClass:"comment-input-actions"},[e("el-button",{attrs:{type:"primary",loading:t.submitting,disabled:!t.newComment.trim()},on:{click:t.submitComment}},[t._v(" 发表评论 ")])],1)],1):e("div",{staticClass:"login-prompt"},[e("el-alert",{attrs:{title:"请先登录后再发表评论",type:"info","show-icon":"",closable:!1}},[e("el-button",{attrs:{type:"text"},on:{click:t.goToLogin}},[t._v("去登录")])],1)],1),e("div",{staticClass:"comment-list"},[0===t.comments.length?e("div",{staticClass:"no-comments"},[e("p",[t._v("暂无评论，快来发表第一条评论吧！")])]):e("div",{staticClass:"comment-items"},t._l(t.comments,function(s){return e("div",{key:s.id,staticClass:"comment-item"},[e("div",{staticClass:"comment-avatar"},[e("el-avatar",{attrs:{src:s.userAvatar||t.defaultAvatar,size:40}},[t._v(" "+t._s(s.userName?s.userName.charAt(0).toUpperCase():"U")+" ")])],1),e("div",{staticClass:"comment-content"},[e("div",{staticClass:"comment-meta"},[e("span",{staticClass:"comment-author"},[t._v(t._s(s.userName||"匿名用户"))]),e("span",{staticClass:"comment-time"},[t._v(t._s(t.formatTime(s.createTime)))])]),e("div",{staticClass:"comment-text"},[t._v(" "+t._s(s.content)+" ")]),e("div",{staticClass:"comment-actions"},[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.replyToComment(s)}}},[t._v(" 回复 ")])],1),t.replyingTo===s.id?e("div",{staticClass:"reply-input-area"},[e("el-input",{staticClass:"reply-input",attrs:{type:"textarea",rows:2,placeholder:`回复 ${s.userName||"匿名用户"}：`},model:{value:t.replyContent,callback:function(e){t.replyContent=e},expression:"replyContent"}}),e("div",{staticClass:"reply-actions"},[e("el-button",{attrs:{type:"primary",size:"small",loading:t.submitting,disabled:!t.replyContent.trim()},on:{click:function(e){return t.submitReply(s)}}},[t._v(" 回复 ")]),e("el-button",{attrs:{type:"text",size:"small"},on:{click:t.cancelReply}},[t._v(" 取消 ")])],1)],1):t._e(),s.replies&&s.replies.length>0?e("div",{staticClass:"replies-list"},t._l(s.replies,function(s){return e("div",{key:s.id,staticClass:"reply-item"},[e("div",{staticClass:"reply-avatar"},[e("el-avatar",{attrs:{src:s.userAvatar||t.defaultAvatar,size:30}},[t._v(" "+t._s(s.userName?s.userName.charAt(0).toUpperCase():"U")+" ")])],1),e("div",{staticClass:"reply-content"},[e("div",{staticClass:"reply-meta"},[e("span",{staticClass:"reply-author"},[t._v(t._s(s.userName||"匿名用户"))]),e("span",{staticClass:"reply-time"},[t._v(t._s(t.formatTime(s.createTime)))])]),e("div",{staticClass:"reply-text"},[e("span",{staticClass:"reply-to"},[t._v("回复 "+t._s(s.parentUserName||"匿名用户")+"：")]),t._v(" "+t._s(s.content)+" ")])])])}),0):t._e()])])}),0)])])},n=[],r=(s(4114),s(5067),{name:"Comment",props:{bookId:{type:[Number,String],required:!0}},data(){return{comments:[],newComment:"",replyContent:"",replyingTo:null,submitting:!1,loading:!1,defaultAvatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",userInfo:null}},computed:{isLoggedIn(){return this.userInfo&&this.userInfo.id}},created(){this.userInfo=JSON.parse(localStorage.getItem("userInfo")||"{}"),this.loadComments()},methods:{async loadComments(){try{this.loading=!0,this.comments=this.getMockComments()}catch(t){console.error("加载评论失败:",t),this.$message.error("加载评论失败")}finally{this.loading=!1}},async submitComment(){if(this.newComment.trim())try{this.submitting=!0;const t={id:Date.now(),bookId:this.bookId,userId:this.userInfo.id,userName:this.userInfo.name||this.userInfo.username,userAvatar:this.userInfo.avatar,content:this.newComment.trim(),createTime:new Date,parentId:null,replies:[]};this.comments.unshift(t),this.newComment="",this.$message.success("评论发表成功")}catch(t){console.error("发表评论失败:",t),this.$message.error("发表评论失败")}finally{this.submitting=!1}},replyToComment(t){this.replyingTo=t.id,this.replyContent=""},cancelReply(){this.replyingTo=null,this.replyContent=""},async submitReply(t){if(this.replyContent.trim())try{this.submitting=!0;const e={id:Date.now(),bookId:this.bookId,userId:this.userInfo.id,userName:this.userInfo.name||this.userInfo.username,userAvatar:this.userInfo.avatar,content:this.replyContent.trim(),createTime:new Date,parentId:t.id,parentUserName:t.userName||"匿名用户"};t.replies||this.$set(t,"replies",[]),t.replies.push(e),this.replyContent="",this.replyingTo=null,this.$message.success("回复成功")}catch(e){console.error("回复失败:",e),this.$message.error("回复失败")}finally{this.submitting=!1}},goToLogin(){this.$router.push("/login")},formatTime(t){if(!t)return"";const e=new Date(t),s=new Date,o=s-e;return o<6e4?"刚刚":o<36e5?Math.floor(o/6e4)+"分钟前":o<864e5?Math.floor(o/36e5)+"小时前":o<2592e6?Math.floor(o/864e5)+"天前":e.toLocaleDateString()},getMockComments(){return[{id:1,bookId:this.bookId,userId:1,userName:"番茄",userAvatar:"http://localhost:9090/files/1741934276948-1.png",content:"这本书非常精彩，内容丰富，值得一读！作者的写作风格很独特，故事情节引人入胜。",createTime:new Date(Date.now()-864e5),parentId:null,replies:[{id:2,bookId:this.bookId,userId:2,userName:"番茄你个西红柿",userAvatar:"http://localhost:9090/files/1751524617169-3.jpg",content:"我也觉得很不错，特别是其中的推理部分，让人意想不到。",createTime:new Date(Date.now()-432e5),parentId:1,parentUserName:"番茄"}]},{id:3,bookId:this.bookId,userId:2,userName:"番茄你个西红柿",userAvatar:"http://localhost:9090/files/1751524617169-3.jpg",content:"推荐大家购买，性价比很高。印刷质量也很好，读起来很舒服。",createTime:new Date(Date.now()-1728e5),parentId:null,replies:[]}]}}}),l=r,c=s(1656),m=(0,c.A)(l,i,n,!1,null,"9674866c",null),u=m.exports,p={name:"BookDetail",components:{Comment:u},data(){return{booknum:0,bookStr:"",book:null,loading:!1,isDescriptionExpanded:!1,showReadMore:!1,error:null}},created(){if(this.bookStr=this.$route.query.book,this.bookStr)try{return void(this.book=JSON.parse(this.bookStr))}catch(t){console.error("无效的图书数据",t)}this.loadBookDetail()},mounted(){this.checkDescriptionOverflow()},methods:{loadBookDetail(){const t=this.$route.query.id;t?(this.loading=!0,this.error=null,request.get(`/book/selectById?id=${t}`).then(t=>{"0"===t.code?this.book=t.data:this.error=t.msg||"获取图书信息失败"}).catch(t=>{this.error="请求出错，请稍后重试",console.error("Error fetching book detail:",t)}).finally(()=>{this.loading=!1})):this.error="图书ID不存在"},checkDescriptionOverflow(){const t=this.$refs.descriptionText;t&&(this.showReadMore=t.scrollHeight>t.clientHeight&&!this.isDescriptionExpanded)},toggleDescription(){this.isDescriptionExpanded=!this.isDescriptionExpanded,this.$nextTick(()=>{this.checkDescriptionOverflow()})}}},d=p,h=(0,c.A)(d,o,a,!1,null,"acb1ea4e",null),v=h.exports}}]);
//# sourceMappingURL=222.795af261.js.map